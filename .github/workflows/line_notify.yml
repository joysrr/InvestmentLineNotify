name: Line Notify Scheduler

on:
  workflow_dispatch:
  schedule:
    # 考量延遲，設定提早
    - cron: '40 22 * * *'    # 台灣 06:40 (開盤前)
    - cron: '30 05 * * *'    # 台灣 13:30 (收盤)

jobs:
  notify:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'  # 直接指定使用 Node 20
        cache: 'npm'

    - name: Install dependencies
      run: npm ci  # 使用 ci 安裝會比 install 更乾淨穩定

    - name: Run Daily Check
      # 這裡需要把你的環境變數注入進去
      env:
        BASE_PRICE_URL: ${{ secrets.BASE_PRICE_URL }}
        STRATEGY_URL: ${{ secrets.STRATEGY_URL }}
        USER_ID: ${{ secrets.USER_ID }}
        LINE_ACCESS_TOKEN: ${{ secrets.LINE_ACCESS_TOKEN }}
        GOOGLE_SERVICE_ACCOUNT_EMAIL: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_EMAIL }}
        GOOGLE_PRIVATE_KEY: ${{ secrets.GOOGLE_PRIVATE_KEY }}
        GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        ALPHA_VANTAGE_API_KEY: ${{ secrets.ALPHA_VANTAGE_API_KEY }}
        FRED_API_KEY: ${{ secrets.FRED_API_KEY }}
        # 如果還有其他變數 (如 TZ 時區)，也可以加在這裡
        TZ: 'Asia/Taipei' 
      run: npm start





